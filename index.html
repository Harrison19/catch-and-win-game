
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Catch & Win – Laundry Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #f0f8ff, #e0f7fa);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    #container {
      margin: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: 420px;
      width: 100%;
    }

    h1 {
      margin: 0 0 10px;
      font-size: 22px;
      text-align: center;
      color: #333;
    }

    #subtitle {
      font-size: 14px;
      text-align: center;
      margin-bottom: 10px;
      color: #555;
    }

    #gameWrapper {
      position: relative;
    }

    canvas {
      border: 3px solid #333;
      border-radius: 10px;
      background: #bbdefb;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      display: block;
    }

    #overlayMessage {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      background: rgba(0, 0, 0, 0.55);
      color: #fff;
      padding: 20px;
      box-sizing: border-box;
      border-radius: 10px;
      cursor: pointer;
    }

    #overlayMessage.hidden {
      display: none;
    }

    #overlayMessage button {
      margin-top: 12px;
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }

    #infoBar {
      margin-top: 8px;
      font-size: 14px;
      text-align: center;
      color: #444;
    }

    #questionsSection,
    #resultSection {
      margin-top: 16px;
      width: 100%;
      max-width: 420px;
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 14px 16px;
      box-sizing: border-box;
      display: none;
    }

    #questionsSection h2,
    #resultSection h2 {
      margin-top: 0;
      font-size: 18px;
      margin-bottom: 10px;
    }

    .question {
      margin-bottom: 10px;
      font-size: 14px;
    }

    label {
      display: block;
      margin-bottom: 4px;
      font-weight: 600;
    }

    select {
      width: 100%;
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }

    #submitAnswers {
      margin-top: 8px;
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      background: #1976d2;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
    }

    #submitAnswers:hover {
      background: #0f5ca4;
    }

    #resultText {
      font-size: 14px;
      margin-bottom: 10px;
    }

    .btn-row {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .result-btn {
      flex: 1;
      min-width: 120px;
      padding: 8px;
      text-align: center;
      border-radius: 999px;
      border: none;
      background: #eeeeee;
      cursor: pointer;
      font-size: 13px;
    }

    .result-btn.primary {
      background: #1976d2;
      color: #fff;
    }

    .result-btn.primary:hover {
      background: #0f5ca4;
    }

    .small-note {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>Catch & Win</h1>
    <div id="subtitle">
      You have 5 chances to catch falling detergent pods and unlock your reward.
    </div>

    <div id="gameWrapper">
      <canvas id="gameCanvas" width="360" height="540"></canvas>
      <div id="overlayMessage">
        <div>
          <div style="font-size:18px; margin-bottom:6px;">
            Tap to start, catch as many as you can
          </div>
          <div style="font-size:14px;">
            Move the basket left and right with your mouse or arrow keys.
            Pegs will make the pods bounce. Most people catch 1–2.
          </div>
          <button>Start Game</button>
        </div>
      </div>
    </div>

    <div id="infoBar">
      Catches: <span id="catchesDisplay">0</span> / 5 | Misses:
      <span id="missesDisplay">0</span>
    </div>

    <div id="questionsSection">
      <h2>Quick questions before you unlock your reward</h2>

      <div class="question">
        <label for="qPets">Do you have pets?</label>
        <select id="qPets">
          <option value="">Select one</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
        </select>
      </div>

      <div class="question">
        <label for="qMachine">What type of machine do you use?</label>
        <select id="qMachine">
          <option value="">Select one</option>
          <option value="top">Top loader</option>
          <option value="front">Front loader</option>
        </select>
      </div>

      <div class="question">
        <label for="qFrustration">What is your biggest laundry frustration?</label>
        <select id="qFrustration">
          <option value="">Select one</option>
          <option value="smell">Smell</option>
          <option value="stains">Stains</option>
          <option value="time">Time</option>
          <option value="pet-hair">Pet hair</option>
        </select>
      </div>

      <div class="question">
        <label for="qDogCat">Do you have a dog or cat?</label>
        <select id="qDogCat">
          <option value="">Select one</option>
          <option value="dog">Dog</option>
          <option value="cat">Cat</option>
          <option value="both">Both</option>
          <option value="neither">Neither</option>
        </select>
      </div>

      <div class="question">
        <label for="qCleanHome">How important is a clean / fresh home?</label>
        <select id="qCleanHome">
          <option value="">Select 1–5</option>
          <option value="1">1 – Not that important</option>
          <option value="2">2</option>
          <option value="3">3 – Somewhat important</option>
          <option value="4">4</option>
          <option value="5">5 – Very important</option>
        </select>
      </div>

      <button id="submitAnswers">See my reward</button>
      <div class="small-note">
        Your answers help us tailor future tips and offers to your home.
      </div>
    </div>

    <div id="resultSection">
      <h2>Your reward</h2>
      <div id="resultText"></div>
      <div class="small-note" id="expiresNote">
        This offer is valid for the next 24 hours.
      </div>
      <div class="btn-row">
        <button class="result-btn primary" id="goToSiteBtn">
          Go back to checkout
        </button>
        <button class="result-btn" id="shareBtn">
          Share this game
        </button>
      </div>
      <div class="small-note">
        For your marketing/dev team: answers and reward can be sent to your
        backend/database. Right now they are just logged in the console.
      </div>
    </div>
  </div>

  <script>
    // Canvas setup
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Overlay and UI
    const overlay = document.getElementById("overlayMessage");
    const catchesDisplay = document.getElementById("catchesDisplay");
    const missesDisplay = document.getElementById("missesDisplay");
    const questionsSection = document.getElementById("questionsSection");
    const resultSection = document.getElementById("resultSection");
    const resultText = document.getElementById("resultText");

    const qPets = document.getElementById("qPets");
    const qMachine = document.getElementById("qMachine");
    const qFrustration = document.getElementById("qFrustration");
    const qDogCat = document.getElementById("qDogCat");
    const qCleanHome = document.getElementById("qCleanHome");
    const submitAnswers = document.getElementById("submitAnswers");
    const goToSiteBtn = document.getElementById("goToSiteBtn");
    const shareBtn = document.getElementById("shareBtn");

    // Game state
    let gameRunning = false;
    let totalBalls = 5;
    let currentBallIndex = 0;
    let catches = 0;
    let misses = 0;

    // Basket
    const basket = {
      width: 90,
      height: 18,
      x: canvas.width / 2 - 45,
      y: canvas.height - 50,
      speed: 6,
      movingLeft: false,
      movingRight: false,
    };

    // Ball
    const ball = {
      radius: 10,
      x: canvas.width / 2,
      y: 40,
      vx: 0,
      vy: 2,
      gravity: 0.25,
      active: false,
    };

    // Pegs (Plinko-style)
    const pegs = [];
    function createPegs() {
      pegs.length = 0;
      const rows = 6;
      const cols = 7;
      const spacingX = canvas.width / (cols + 1);
      const spacingY = 60;
      const startY = 100;
      const radius = 6;

      for (let row = 0; row < rows; row++) {
        for (let col = 0; col < cols; col++) {
          const offsetX = row % 2 === 0 ? spacingX / 2 : 0; // staggered
          const x = spacingX * (col + 1) + offsetX * 0.7;
          const y = startY + row * spacingY;

          pegs.push({ x, y, r: radius });
        }
      }
    }

    createPegs();

    function resetBall() {
      currentBallIndex++;
      if (currentBallIndex > totalBalls) {
        endGame();
        return;
      }
      ball.x = canvas.width / 2;
      ball.y = 40;
      ball.vx = (Math.random() - 0.5) * 1.5; // slight random drift
      ball.vy = 2;
      ball.active = true;
    }

    function endGame() {
      gameRunning = false;
      ball.active = false;
      questionsSection.style.display = "block";
    }

    // Drawing
    function drawBackground() {
      // Light vertical gradient-ish background already in CSS,
      // here we just draw “ground”
      ctx.fillStyle = "#e3f2fd";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = "#c8e6c9";
      ctx.fillRect(0, canvas.height - 60, canvas.width, 60);
    }

    function drawPegs() {
      ctx.fillStyle = "#90caf9";
      ctx.strokeStyle = "#1976d2";
      ctx.lineWidth = 1.5;
      pegs.forEach((peg) => {
        ctx.beginPath();
        ctx.arc(peg.x, peg.y, peg.r, 0, Math.PI * 2);
        ctx.fill();
        ctx.stroke();
      });
    }

    function drawBasket() {
      ctx.fillStyle = "#ffb74d";
      ctx.fillRect(basket.x, basket.y, basket.width, basket.height);

      // simple handle detail
      ctx.strokeStyle = "#f57c00";
      ctx.lineWidth = 2;
      ctx.strokeRect(basket.x, basket.y, basket.width, basket.height);
    }

    function drawBall() {
      if (!ball.active) return;
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
      ctx.fillStyle = "#fff176";
      ctx.fill();
      ctx.strokeStyle = "#fbc02d";
      ctx.lineWidth = 2;
      ctx.stroke();
    }

    function updateBasket() {
      if (basket.movingLeft) {
        basket.x -= basket.speed;
      }
      if (basket.movingRight) {
        basket.x += basket.speed;
      }
      // clamp
      if (basket.x < 10) basket.x = 10;
      if (basket.x + basket.width > canvas.width - 10) {
        basket.x = canvas.width - 10 - basket.width;
      }
    }

    function updateBall() {
      if (!ball.active) return;

      // Gravity and movement
      ball.vy += ball.gravity;
      ball.x += ball.vx;
      ball.y += ball.vy;

      // Slight wall bounce to keep it interesting
      if (ball.x - ball.radius < 0) {
        ball.x = ball.radius;
        ball.vx *= -0.6;
      } else if (ball.x + ball.radius > canvas.width) {
        ball.x = canvas.width - ball.radius;
        ball.vx *= -0.6;
      }

      // Peg collisions
      for (let peg of pegs) {
        const dx = ball.x - peg.x;
        const dy = ball.y - peg.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < ball.radius + peg.r) {
          // Simple bounce: reflect velocity along normal
          const nx = dx / dist;
          const ny = dy / dist;
          const dot = ball.vx * nx + ball.vy * ny;
          ball.vx = ball.vx - 2 * dot * nx;
          ball.vy = ball.vy - 2 * dot * ny;

          // Add a little randomness so paths are less predictable
          ball.vx += (Math.random() - 0.5) * 0.7;
          ball.vy += (Math.random() - 0.5) * 0.7;

          // Push ball slightly out of peg
          const overlap = ball.radius + peg.r - dist;
          ball.x += nx * overlap;
          ball.y += ny * overlap;
        }
      }

      // Check catch
      if (
        ball.y + ball.radius >= basket.y &&
        ball.y - ball.radius <= basket.y + basket.height &&
        ball.x >= basket.x &&
        ball.x <= basket.x + basket.width
      ) {
        catches++;
        catchesDisplay.textContent = catches;
        ball.active = false;
        setTimeout(resetBall, 400);
        return;
      }

      // Miss
      if (ball.y - ball.radius > canvas.height) {
        misses++;
        missesDisplay.textContent = misses;
        ball.active = false;
        setTimeout(resetBall, 400);
      }
    }

    function drawHUD() {
      ctx.fillStyle = "#000000aa";
      ctx.font = "16px Arial";
      ctx.fillText("Chances: " + (totalBalls - currentBallIndex + 1), 10, 20);
      ctx.fillText("Caught: " + catches, 10, 40);
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBackground();
      drawPegs();
      drawBasket();
      drawBall();
      drawHUD();

      if (gameRunning) {
        updateBasket();
        updateBall();
      }

      requestAnimationFrame(gameLoop);
    }

    // Controls
    window.addEventListener("keydown", (e) => {
      if (!gameRunning) return;
      if (e.key === "ArrowLeft") basket.movingLeft = true;
      if (e.key === "ArrowRight") basket.movingRight = true;
    });

    window.addEventListener("keyup", (e) => {
      if (e.key === "ArrowLeft") basket.movingLeft = false;
      if (e.key === "ArrowRight") basket.movingRight = false;
    });

    // Mouse move to control basket (easier for most users)
    canvas.addEventListener("mousemove", (e) => {
      if (!gameRunning) return;
      const rect = canvas.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      basket.x = mouseX - basket.width / 2;
    });

    // Start game
    function startGame() {
      if (gameRunning) return;
      overlay.classList.add("hidden");
      gameRunning = true;
      currentBallIndex = 0;
      catches = 0;
      misses = 0;
      catchesDisplay.textContent = "0";
      missesDisplay.textContent = "0";
      resetBall();
    }

    overlay.addEventListener("click", startGame);

    // Questions -> result
    submitAnswers.addEventListener("click", () => {
      // For now, just basic validation: require all fields
      if (
        !qPets.value ||
        !qMachine.value ||
        !qFrustration.value ||
        !qDogCat.value ||
        !qCleanHome.value
      ) {
        alert("Please answer all questions to unlock your reward.");
        return;
      }

      const reward = computeReward(catches);
      const answers = {
        pets: qPets.value,
        machine: qMachine.value,
        frustration: qFrustration.value,
        dogCat: qDogCat.value,
        cleanHomeImportance: qCleanHome.value,
        catches: catches,
        reward: reward,
      };

      console.log("Game answers + reward payload:", answers);

      questionsSection.style.display = "none";
      resultSection.style.display = "block";
      resultText.innerHTML =
        "You caught " +
        catches +
        " out of " +
        totalBalls +
        " pods.<br>" +
        "Your reward: <strong>" +
        reward +
        "</strong>";
    });

    // Reward logic: free shipping baseline + best discount
    // Simple mapping:
    // 0–2 catches → Free shipping
    // 3–4 catches → Free shipping + 5% off
    // 5 catches   → Free shipping + 10% off
    function computeReward(catchCount) {
      if (catchCount >= 5) {
        return "Free shipping + 10% off your order";
      } else if (catchCount >= 3) {
        return "Free shipping + 5% off your order";
      } else {
        return "Free shipping on your next order";
      }
    }

    // Buttons for link / share (placeholders for your team)
    goToSiteBtn.addEventListener("click", () => {
      // Example UTM link; your team can drop in the real one
      window.location.href =
        "https://yourbrand.com/cart?utm_source=abandoned_cart_game&utm_medium=game&utm_campaign=catch_and_win";
    });

    shareBtn.addEventListener("click", async () => {
      const shareUrl = window.location.href; // or a dedicated campaign link
      const shareText =
        "I just played this laundry Catch & Win game and unlocked a reward. Try your luck:";

      if (navigator.share) {
        try {
          await navigator.share({
            title: "Catch & Win Game",
            text: shareText,
            url: shareUrl,
          });
        } catch (e) {
          console.log("Share dismissed", e);
        }
      } else {
        // Fallback: copy link
        try {
          await navigator.clipboard.writeText(shareUrl);
          alert("Link copied. You can paste and share it with a friend.");
        } catch (e) {
          alert("Here is the link to share:\n" + shareUrl);
        }
      }
    });

    // Start loop
    gameLoop();
  </script>
</body>
</html>
