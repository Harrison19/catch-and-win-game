<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Uproot Clean – Catch the drops</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --blue-bg: #ddeeff;
            --card-bg: #ffffff;
            --primary: #2563ff;
            --primary-dark: #1d4ed8;
            --purple: #7c3aed;
            --text-main: #111827;
            --text-sub: #4b5563;
            --chip-bg: #eef4ff;
            --border-soft: #e5e7eb;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 24px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at top, #e3f2ff 0, #c5ddff 30%, #c9d9ff 55%, #bfcff8 100%);
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            color: var(--text-main);
        }

        .card {
            width: 420px;
            max-width: 100%;
            background: var(--card-bg);
            border-radius: 28px;
            box-shadow: 0 18px 45px rgba(15, 23, 42, 0.18);
            padding: 24px 24px 20px;
        }

        .hidden {
            display: none;
        }

        .logo-row {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 18px;
        }

        .logo-row img {
            max-width: 260px;       /* slightly smaller than before */
            height: auto;
            display: block;
        }

        h1 {
            margin: 0 0 4px;
            font-size: 20px;
        }

        p {
            margin: 4px 0;
            font-size: 14px;
            color: var(--text-sub);
        }

        .intro-box {
            margin-top: 18px;
            padding: 14px 16px 16px;
            border-radius: 18px;
            background: linear-gradient(135deg, #f5f7ff, #ecf2ff);
            border: 1px solid #e0e7ff;
        }

        .intro-box-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 6px;
        }

        .chip {
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            background: var(--chip-bg);
            color: var(--primary-dark);
            border: 1px solid #d1ddff;
        }

        .intro-meta {
            margin-top: 12px;
            font-size: 12px;
            color: #9ca3af;
        }

        .btn-row {
            margin-top: 22px;
            display: flex;
            gap: 12px;
        }

        .btn {
            flex: 1;
            border-radius: 999px;
            padding: 12px 14px;
            border: none;
            font-size: 15px;
            cursor: pointer;
            transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.12s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.45);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 14px 30px rgba(37, 99, 235, 0.55);
        }

        .btn-secondary {
            background: #f3f4ff;
            color: var(--text-main);
        }

        .btn-secondary:hover {
            background: #e5e7ff;
        }

        /* Game view */

        .game-wrapper {
            margin-top: 12px;
            padding: 12px;
            border-radius: 22px;
            background: radial-gradient(circle at top, #f7fbff 0, #eff5ff 45%, #e4ecff 100%);
            border: 1px solid #e5edff;
        }

        canvas {
            display: block;
            width: 100%;
            height: auto;
            border-radius: 20px;
            background: linear-gradient(#f9fbff, #eef4ff);
            box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.15);
        }

        .game-info-row {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: #6b7280;
        }

        .game-tip {
            margin-top: 4px;
            font-size: 11px;
            color: #9ca3af;
        }

        hr {
            border: none;
            border-top: 1px solid var(--border-soft);
            margin: 16px -4px 16px;
        }

        /* Questions */

        .question-group {
            margin-top: 10px;
        }

        .question-label {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 6px;
        }

        .options-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .pill-option {
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid #d1d5db;
            font-size: 13px;
            cursor: pointer;
            background: #f9fafb;
            transition: background 0.1s, border-color 0.1s, color 0.1s;
        }

        .pill-option.selected {
            background: #e0ebff;
            border-color: #2563eb;
            color: #1d4ed8;
        }

        .scale-row {
            display: flex;
            gap: 6px;
        }

        .scale-btn {
            width: 32px;
            height: 32px;
            border-radius: 999px;
            border: 1px solid #d1d5db;
            background: #f9fafb;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.1s, border-color 0.1s;
        }

        .scale-btn.selected {
            background: #2563eb;
            border-color: #1d4ed8;
            color: white;
        }

        .reward-tag {
            margin-top: 6px;
            font-size: 12px;
            color: #059669;
        }

        .final-links {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .link-btn {
            flex: 1;
            border-radius: 999px;
            font-size: 14px;
            border: 1px solid #d1d5db;
            background: #f9fafb;
            padding: 10px 12px;
            cursor: pointer;
        }

        .link-btn-primary {
            border-color: #2563eb;
            color: #2563eb;
            background: #eef2ff;
        }
    </style>
</head>
<body>

<!-- Intro screen -->
<div id="introScreen" class="card">
    <div class="logo-row">
        <!-- Replace src with your logo path -->
        <img src="logo-uproot-clean.webp" alt="Uproot Clean logo">
    </div>

    <h1>Catch the drops</h1>
    <p>You get 5 chances to catch as many drops as you can. The more you catch, the better your reward.</p>

    <div class="intro-box">
        <div class="intro-box-title">Here is what you can win:</div>
        <div class="chips">
            <div class="chip">Free shipping</div>
            <div class="chip">+ 5% off</div>
            <div class="chip">+ 10% off</div>
        </div>
        <p style="font-size:12px;margin-top:4px;">
            Your reward is based on how many drops you catch. No pressure, just a little fun while your cart waits.
        </p>
    </div>

    <p class="intro-meta">Takes about 30–45 seconds. No app to download.</p>

    <div class="btn-row">
        <!-- Only one button now -->
        <button id="startGameBtn" class="btn btn-primary">Play &amp; reveal my reward</button>
    </div>
</div>

<!-- Game screen -->
<div id="gameScreen" class="card hidden">
    <div class="logo-row">
        <img src="logo-uproot-clean.webp" alt="Uproot Clean logo">
    </div>

    <h1>Catch the drops</h1>
    <p>Bounce through the pegs and catch as many as you can.</p>

    <div class="game-wrapper">
        <canvas id="gameCanvas" width="320" height="420"></canvas>
        <div class="game-info-row">
            <span>Drops left: <span id="dropsLeftLabel">5</span></span>
            <span>Caught: <span id="caughtLabel">0</span></span>
        </div>
        <div class="game-tip">Tip: drag or use ◄ ► to move the basket.</div>
    </div>
</div>

<!-- Questions screen -->
<div id="questionsScreen" class="card hidden">
    <div class="logo-row">
        <img src="logo-uproot-clean.webp" alt="Uproot Clean logo">
    </div>

    <h1>Quick questions about your laundry</h1>
    <p id="rewardSummary" style="margin-bottom:10px;"></p>
    <hr>

    <form id="questionsForm">
        <div class="question-group">
            <div class="question-label">1. Do you have pets?</div>
            <div class="options-row" data-name="havePets">
                <button type="button" class="pill-option" data-value="yes">Yes</button>
                <button type="button" class="pill-option" data-value="no">No</button>
            </div>
        </div>

        <div class="question-group">
            <div class="question-label">2. What type of machine do you use?</div>
            <div class="options-row" data-name="machineType">
                <button type="button" class="pill-option" data-value="top">Top loader</button>
                <button type="button" class="pill-option" data-value="front">Front loader</button>
                <button type="button" class="pill-option" data-value="both">Both</button>
            </div>
        </div>

        <div class="question-group">
            <div class="question-label">3. What is your biggest laundry frustration?</div>
            <div class="options-row" data-name="frustration">
                <button type="button" class="pill-option" data-value="smell">Smell</button>
                <button type="button" class="pill-option" data-value="stains">Stains</button>
                <button type="button" class="pill-option" data-value="time">Time</button>
                <button type="button" class="pill-option" data-value="petHair">Pet hair</button>
            </div>
        </div>

        <div class="question-group">
            <div class="question-label">4. Do you have a dog or cat?</div>
            <div class="options-row" data-name="petType">
                <button type="button" class="pill-option" data-value="dog">Dog</button>
                <button type="button" class="pill-option" data-value="cat">Cat</button>
                <button type="button" class="pill-option" data-value="both">Both</button>
                <button type="button" class="pill-option" data-value="neither">Neither</button>
            </div>
        </div>

        <div class="question-group">
            <div class="question-label">5. How important is a clean, fresh home?</div>
            <div class="scale-row" data-name="cleanImportance">
                <button type="button" class="scale-btn" data-value="1">1</button>
                <button type="button" class="scale-btn" data-value="2">2</button>
                <button type="button" class="scale-btn" data-value="3">3</button>
                <button type="button" class="scale-btn" data-value="4">4</button>
                <button type="button" class="scale-btn" data-value="5">5</button>
            </div>
        </div>

        <div class="reward-tag" id="rewardTag"></div>

        <div class="btn-row" style="margin-top:20px;">
            <button type="submit" class="btn btn-primary">Save my answers</button>
        </div>
    </form>
</div>

<!-- Final screen -->
<div id="finalScreen" class="card hidden">
    <div class="logo-row">
        <img src="logo-uproot-clean.webp" alt="Uproot Clean logo">
    </div>

    <h1>Your reward is ready</h1>
    <p id="finalRewardText"></p>
    <p style="font-size:13px;margin-top:6px;">
        You will see your reward applied at checkout from this link. You can share it once with a friend, or play a demo round just for fun.
    </p>

    <div class="final-links">
        <button class="link-btn link-btn-primary" id="demoBtn">Play demo</button>
        <button class="link-btn" id="shareBtn">Share my reward</button>
    </div>
</div>

<script>
    // Screen elements
    const introScreen = document.getElementById('introScreen');
    const gameScreen = document.getElementById('gameScreen');
    const questionsScreen = document.getElementById('questionsScreen');
    const finalScreen = document.getElementById('finalScreen');

    const startGameBtn = document.getElementById('startGameBtn');

    // Game elements
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const dropsLeftLabel = document.getElementById('dropsLeftLabel');
    const caughtLabel = document.getElementById('caughtLabel');

    const width = canvas.width;
    const height = canvas.height;

    const pegs = [];
    const pegRadius = 6;
    const pegRows = 4; // good balance with difficulty
    const gravity = 0.27;  // slightly lower = less crazy
    const ballRadius = 8;

    const basket = {
        width: width * 0.28,  // about 2/3 of earlier wide basket
        height: 10,
        x: (width * 0.5) - (width * 0.14),
        y: height - 40,
        speed: 5
    };

    let ball = null;
    let dropsLeft = 5;
    let caught = 0;
    let animationId = null;
    let gameActive = false;

    function createPegs() {
        pegs.length = 0;
        const topOffset = 90;
        const rowSpacing = 60;
        const colSpacing = 42;

        for (let row = 0; row < pegRows; row++) {
            const y = topOffset + row * rowSpacing;
            const cols = 7;
            for (let col = 0; col < cols; col++) {
                const offset = (row % 2 === 0) ? 0 : colSpacing / 2;
                const x = 40 + col * colSpacing + offset;
                pegs.push({x, y});
            }
        }
    }

    function resetGameState() {
        dropsLeft = 5;
        caught = 0;
        dropsLeftLabel.textContent = dropsLeft;
        caughtLabel.textContent = caught;
        ball = null;
        createPegs();
        gameActive = true;
    }

    function spawnBall() {
        if (dropsLeft <= 0) {
            // no more – wait for last ball to finish
            return;
        }
        dropsLeft--;
        dropsLeftLabel.textContent = dropsLeft;
        ball = {
            x: width / 2,
            y: 60,
            vx: 0,
            vy: 0.5,
            active: true
        };
    }

    function updateBall() {
        if (!ball || !ball.active) return;

        // gravity
        ball.vy += gravity;
        ball.y += ball.vy;
        ball.x += ball.vx;

        // wall bounce
        if (ball.x - ballRadius < 15) {
            ball.x = 15 + ballRadius;
            ball.vx = Math.abs(ball.vx) * 0.6;
        } else if (ball.x + ballRadius > width - 15) {
            ball.x = width - 15 - ballRadius;
            ball.vx = -Math.abs(ball.vx) * 0.6;
        }

        // peg collisions
        for (const peg of pegs) {
            const dx = ball.x - peg.x;
            const dy = ball.y - peg.y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            if (dist < pegRadius + ballRadius) {
                // simple deflection – push out and tweak vx
                const angle = Math.atan2(dy, dx);
                const targetDist = pegRadius + ballRadius + 0.5;
                ball.x = peg.x + Math.cos(angle) * targetDist;
                ball.y = peg.y + Math.sin(angle) * targetDist;
                ball.vy = Math.abs(ball.vy) * 0.7;
                ball.vx += (dx > 0 ? 1 : -1) * (0.7 + Math.random() * 0.4);
            }
        }

        // basket catch
        if (ball.y + ballRadius >= basket.y &&
            ball.y + ballRadius <= basket.y + basket.height + 6 &&
            ball.x >= basket.x &&
            ball.x <= basket.x + basket.width &&
            ball.vy > 0) {
            caught++;
            caughtLabel.textContent = caught;
            ball.active = false;
            ball = null;
            setTimeout(() => {
                if (dropsLeft > 0) {
                    spawnBall();
                } else {
                    endGameAfterDelay();
                }
            }, 450);
            return;
        }

        // missed – fell past
        if (ball.y - ballRadius > height) {
            ball.active = false;
            ball = null;
            setTimeout(() => {
                if (dropsLeft > 0) {
                    spawnBall();
                } else {
                    endGameAfterDelay();
                }
            }, 450);
        }
    }

    function drawGame() {
        ctx.clearRect(0, 0, width, height);

        // playfield background
        const grad = ctx.createLinearGradient(0, 0, 0, height);
        grad.addColorStop(0, '#f9fbff');
        grad.addColorStop(1, '#e9f0ff');
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, width, height);

        // top line
        ctx.strokeStyle = '#c4d1ff';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(24, 90);
        ctx.lineTo(width - 24, 90);
        ctx.stroke();

        // pegs
        ctx.fillStyle = '#7c3aed';
        for (const peg of pegs) {
            ctx.beginPath();
            ctx.arc(peg.x, peg.y, pegRadius, 0, Math.PI * 2);
            ctx.fill();
        }

        // basket
        const basketGrad = ctx.createLinearGradient(basket.x, basket.y, basket.x, basket.y + basket.height);
        basketGrad.addColorStop(0, '#2563ff');
        basketGrad.addColorStop(1, '#1d4ed8');
        ctx.fillStyle = basketGrad;
        ctx.roundRect(basket.x, basket.y, basket.width, basket.height, 6);
        ctx.fill();

        // ball
        if (ball && ball.active) {
            ctx.fillStyle = '#fb923c';
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ballRadius, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = 'rgba(255,255,255,0.8)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(ball.x - 2, ball.y - 3, ballRadius - 4, 0, Math.PI * 2);
            ctx.stroke();
        }
    }

    function loop() {
        if (!gameActive) return;
        updateBall();
        drawGame();
        animationId = requestAnimationFrame(loop);
    }

    function startGame() {
        introScreen.classList.add('hidden');
        questionsScreen.classList.add('hidden');
        finalScreen.classList.add('hidden');
        gameScreen.classList.remove('hidden');

        resetGameState();
        spawnBall();      // first drop automatically
        if (animationId) cancelAnimationFrame(animationId);
        loop();
    }

    function endGameAfterDelay() {
        gameActive = false;
        setTimeout(() => {
            gameScreen.classList.add('hidden');
            showQuestions();
        }, 700);
    }

    // Basket controls
    document.addEventListener('keydown', (e) => {
        if (!gameScreen || gameScreen.classList.contains('hidden')) return;
        if (e.key === 'ArrowLeft') {
            basket.x -= basket.speed * 2.2;
        } else if (e.key === 'ArrowRight') {
            basket.x += basket.speed * 2.2;
        }
        clampBasket();
    });

    let dragging = false;
    let dragOffsetX = 0;

    canvas.addEventListener('mousedown', startDrag);
    canvas.addEventListener('touchstart', startDrag, {passive: true});

    function startDrag(e) {
        dragging = true;
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const rect = canvas.getBoundingClientRect();
        const x = clientX - rect.left;
        dragOffsetX = x - basket.x;
    }

    window.addEventListener('mousemove', onDrag);
    window.addEventListener('touchmove', onDrag, {passive: true});
    window.addEventListener('mouseup', () => dragging = false);
    window.addEventListener('touchend', () => dragging = false);

    function onDrag(e) {
        if (!dragging) return;
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const rect = canvas.getBoundingClientRect();
        let x = clientX - rect.left;
        basket.x = x - dragOffsetX;
        clampBasket();
    }

    function clampBasket() {
        if (basket.x < 24) basket.x = 24;
        if (basket.x + basket.width > width - 24) basket.x = width - 24 - basket.width;
    }

    // Start button
    startGameBtn.addEventListener('click', startGame);

    // Questions logic
    function setupPillGroups() {
        document.querySelectorAll('.options-row').forEach(row => {
            row.addEventListener('click', (e) => {
                const btn = e.target.closest('.pill-option');
                if (!btn) return;
                row.querySelectorAll('.pill-option').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
            });
        });

        document.querySelectorAll('.scale-row').forEach(row => {
            row.addEventListener('click', (e) => {
                const btn = e.target.closest('.scale-btn');
                if (!btn) return;
                row.querySelectorAll('.scale-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
            });
        });
    }

    setupPillGroups();

    const rewardSummary = document.getElementById('rewardSummary');
    const rewardTag = document.getElementById('rewardTag');
    const finalRewardText = document.getElementById('finalRewardText');

    function computeRewardText() {
        let tierText = '';
        if (caught >= 4) {
            tierText = 'Free shipping + 10% off your order.';
        } else if (caught >= 2) {
            tierText = 'Free shipping + 5% off your order.';
        } else {
            tierText = 'Free shipping on your order.';
        }
        return tierText;
    }

    function showQuestions() {
        const rewardText = computeRewardText();
        rewardSummary.textContent = `Nice work – you caught ${caught} of 5 drops. You unlocked: ${rewardText}`;
        rewardTag.textContent = rewardText;
        questionsScreen.classList.remove('hidden');
    }

    const questionsForm = document.getElementById('questionsForm');

    questionsForm.addEventListener('submit', (e) => {
        e.preventDefault();

        const data = {};

        document.querySelectorAll('.options-row').forEach(row => {
            const name = row.getAttribute('data-name');
            const selected = row.querySelector('.pill-option.selected');
            data[name] = selected ? selected.getAttribute('data-value') : null;
        });

        document.querySelectorAll('.scale-row').forEach(row => {
            const name = row.getAttribute('data-name');
            const selected = row.querySelector('.scale-btn.selected');
            data[name] = selected ? selected.getAttribute('data-value') : null;
        });

        // TODO: send `data` + game result to your backend / Shopify / Klaviyo, etc.

        questionsScreen.classList.add('hidden');
        const rewardText = computeRewardText();
        finalRewardText.textContent = rewardText +
            ' Use the special link from this message to apply it automatically at checkout.';
        finalScreen.classList.remove('hidden');
    });

    // Final screen buttons – wire however you like later
    document.getElementById('demoBtn').addEventListener('click', () => {
        // Demo round – no data capture, just replay
        finalScreen.classList.add('hidden');
        startGame();
    });

    document.getElementById('shareBtn').addEventListener('click', () => {
        // Placeholder: your unique-share logic / navigator.share etc.
        alert('Share logic goes here – your dev team can plug in the unique discounted link.');
    });
</script>
</body>
</html>
