<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Catch & Win ‚Äì Uproot Clean</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at top, #e6f4ff 0, #d1e7ff 35%, #bfd8ff 70%, #b2d0ff 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #1f2933;
    }

    .card {
      width: 100%;
      max-width: 420px;
      background: #ffffff;
      border-radius: 24px;
      box-shadow: 0 26px 60px rgba(15, 23, 42, 0.22);
      padding: 24px 24px 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .logo-row {
      display: flex;
      justify-content: center;
    }

    .logo-row img {
      max-width: 230px; /* a bit smaller */
      height: auto;
      display: block;
    }

    h1 {
      margin: 4px 0 0;
      font-size: 20px;
      font-weight: 700;
      color: #111827;
    }

    .subtitle {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 8px;
    }

    .section {
      display: none;
      flex-direction: column;
      gap: 16px;
    }

    .section.active {
      display: flex;
    }

    .intro-highlight {
      background: linear-gradient(135deg, rgba(59,130,246,0.06), rgba(45,212,191,0.06));
      border-radius: 16px;
      padding: 12px 14px;
      font-size: 13px;
      color: #374151;
    }

    .intro-highlight strong {
      color: #2563eb;
    }

    .pill-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .pill {
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #f3f4ff;
      color: #4c51bf;
      border: 1px solid rgba(129,140,248,0.35);
    }

    .btn-row {
      display: flex;
      gap: 10px;
    }

    button {
      border-radius: 999px;
      border: none;
      cursor: pointer;
      padding: 10px 16px;
      font-size: 14px;
      font-weight: 600;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
    }

    .btn-primary {
      flex: 1;
      background: linear-gradient(135deg, #2563eb, #3b82f6);
      color: white;
      box-shadow: 0 10px 20px rgba(37, 99, 235, 0.35);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 26px rgba(37, 99, 235, 0.45);
    }

    .btn-ghost {
      flex: 1;
      background: #f3f4ff;
      color: #374151;
      border: 1px solid rgba(148,163,184,0.6);
      box-shadow: none;
    }

    .btn-ghost:hover {
      background: #e5e7ff;
    }

    /* Game area */
    .game-shell {
      background: linear-gradient(180deg, #f7fbff 0%, #eef4ff 100%);
      border-radius: 20px;
      padding: 14px;
      border: 1px solid rgba(148,163,184,0.3);
    }

    #gameCanvas {
      background: radial-gradient(circle at top, #f9fbff 0, #edf2ff 60%, #e4ecff 100%);
      border-radius: 16px;
      display: block;
      margin: 0 auto;
      box-shadow: inset 0 0 0 1px rgba(148,163,184,0.2);
    }

    .game-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      font-size: 12px;
      color: #6b7280;
    }

    .game-meta strong {
      color: #111827;
    }

    .tiny {
      font-size: 11px;
      color: #9ca3af;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    /* Questions */
    .question-block {
      background: #f9fafb;
      border-radius: 14px;
      padding: 10px 12px;
      border: 1px solid rgba(209,213,219,0.7);
    }

    .question-block h3 {
      margin: 0 0 6px;
      font-size: 14px;
      color: #111827;
    }

    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .options label {
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(156,163,175,0.8);
      cursor: pointer;
      background: #ffffff;
    }

    .options input {
      display: none;
    }

    .options input:checked + span {
      background: #2563eb;
      color: white;
      border-color: #2563eb;
    }

    .scale {
      display: flex;
      gap: 6px;
      margin-top: 4px;
    }

    .scale label span {
      width: 26px;
      text-align: center;
      display: inline-block;
    }

    /* Result */
    .reward-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(16, 185, 129, 0.08);
      color: #0f766e;
      border: 1px solid rgba(16,185,129,0.3);
    }

    .reward-main {
      font-size: 18px;
      font-weight: 700;
      margin-top: 4px;
      color: #111827;
    }

    .reward-sub {
      font-size: 13px;
      color: #6b7280;
    }

    @media (max-width: 480px) {
      .card {
        border-radius: 0;
        max-width: 100%;
        min-height: 100vh;
        box-shadow: none;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="logo-row">
      <!-- Replace src with your final logo path -->
      <img src="uproot-clean-logo.png" alt="Uproot Clean logo">
    </div>

    <!-- INTRO SECTION -->
    <div id="introSection" class="section active">
      <div>
        <h1>Catch the drops</h1>
        <p class="subtitle">
          You get 5 chances to catch as many drops as you can. The more you catch, the better your reward.
        </p>
      </div>

      <div class="intro-highlight">
        <strong>Here is what you can win:</strong>
        <div class="pill-list">
          <span class="pill">Free shipping</span>
          <span class="pill">+ 5% off</span>
          <span class="pill">+ 10% off</span>
        </div>
        <div style="margin-top:8px;font-size:12px;color:#6b7280;">
          Your reward is based on how many drops you catch. No pressure, just a little fun while your cart waits.
        </div>
      </div>

      <div>
        <p style="font-size:12px;color:#9ca3af;margin:0 0 6px;">
          Takes about 30‚Äì45 seconds. No app to download.
        </p>
        <div class="btn-row">
          <button class="btn-primary" id="startGameBtn">Play &amp; reveal my reward</button>
          <button class="btn-ghost" id="skipToShopBtn">Skip game</button>
        </div>
      </div>
    </div>

    <!-- GAME SECTION -->
    <div id="gameSection" class="section">
      <div>
        <h1>Catch the drops</h1>
        <p class="subtitle">Bounce through the pegs and catch as many as you can.</p>
      </div>

      <div class="game-shell">
        <canvas id="gameCanvas" width="320" height="420"></canvas>
        <div class="game-meta">
          <span>Drops left: <strong id="dropsLeftText">5</strong></span>
          <span>Caught: <strong id="caughtText">0</strong></span>
        </div>
        <div class="tiny">
          Tip: drag or use ‚óÄ ‚ñ∂ to move the basket.
        </div>
      </div>

      <div class="btn-row">
        <button class="btn-primary" id="doneGameBtn">I am done, continue</button>
      </div>
    </div>

    <!-- QUESTIONS SECTION -->
    <div id="questionsSection" class="section">
      <div>
        <h1>Quick questions</h1>
        <p class="subtitle">
          A few questions so we can recommend the right clean-up plan for your home.
        </p>
      </div>

      <div class="question-block">
        <h3>1. Do you have pets?</h3>
        <div class="options">
          <label><input type="radio" name="pets" value="yes"><span>Yes</span></label>
          <label><input type="radio" name="pets" value="no"><span>No</span></label>
        </div>
      </div>

      <div class="question-block">
        <h3>2. What type of washing machine do you use?</h3>
        <div class="options">
          <label><input type="radio" name="machine" value="top"><span>Top loader</span></label>
          <label><input type="radio" name="machine" value="front"><span>Front loader</span></label>
        </div>
      </div>

      <div class="question-block">
        <h3>3. What is your biggest laundry frustration?</h3>
        <div class="options">
          <label><input type="radio" name="frustration" value="smell"><span>Smell</span></label>
          <label><input type="radio" name="frustration" value="stains"><span>Stains</span></label>
          <label><input type="radio" name="frustration" value="time"><span>Time</span></label>
          <label><input type="radio" name="frustration" value="pet_hair"><span>Pet hair</span></label>
        </div>
      </div>

      <div class="question-block">
        <h3>4. Do you have a dog or cat?</h3>
        <div class="options">
          <label><input type="radio" name="petType" value="dog"><span>Dog</span></label>
          <label><input type="radio" name="petType" value="cat"><span>Cat</span></label>
          <label><input type="radio" name="petType" value="both"><span>Both</span></label>
          <label><input type="radio" name="petType" value="neither"><span>Neither</span></label>
        </div>
      </div>

      <div class="question-block">
        <h3>5. How important is a clean, fresh home to you?</h3>
        <div class="scale">
          <!-- 1‚Äì5 scale -->
          <label><input type="radio" name="cleanScale" value="1"><span>1</span></label>
          <label><input type="radio" name="cleanScale" value="2"><span>2</span></label>
          <label><input type="radio" name="cleanScale" value="3"><span>3</span></label>
          <label><input type="radio" name="cleanScale" value="4"><span>4</span></label>
          <label><input type="radio" name="cleanScale" value="5"><span>5</span></label>
        </div>
        <div class="tiny" style="margin-top:4px;">1 = ‚ÄúNice to have‚Äù, 5 = ‚ÄúNon-negotiable‚Äù.</div>
      </div>

      <div class="btn-row">
        <button class="btn-primary" id="submitQuestionsBtn">See my reward</button>
      </div>
    </div>

    <!-- RESULT SECTION -->
    <div id="resultSection" class="section">
      <div>
        <span class="reward-tag">
          üéâ You caught <span id="resultCaughtCount" style="font-weight:600;"></span> drops
        </span>
        <div class="reward-main" id="rewardTitle"></div>
        <div class="reward-sub" id="rewardSubtitle"></div>
      </div>

      <div class="intro-highlight">
        <strong>Your unique reward link</strong>
        <div style="margin-top:4px;font-size:12px;">
          When you use this link, your discount and free shipping will be applied at checkout.
        </div>
        <div style="margin-top:8px;font-size:12px;word-break:break-all;color:#2563eb;" id="rewardLink">
          <!-- placeholder text, your team will replace with real URL + UTM -->
          https://yourshop.com/cart?utm_source=catch-game
        </div>
      </div>

      <p class="subtitle" style="margin-top:0;">
        You can try the demo again for fun, or share your reward with a friend (one share per customer).
      </p>

      <div class="btn-row">
        <button class="btn-ghost" id="playDemoBtn">Play demo</button>
        <button class="btn-primary" id="shareBtn">Share your reward</button>
      </div>
    </div>
  </div>

  <script>
    // --- Simple "state" handling ---
    const introSection = document.getElementById('introSection');
    const gameSection = document.getElementById('gameSection');
    const questionsSection = document.getElementById('questionsSection');
    const resultSection = document.getElementById('resultSection');

    function showSection(sectionEl) {
      [introSection, gameSection, questionsSection, resultSection].forEach(sec => {
        sec.classList.remove('active');
      });
      sectionEl.classList.add('active');
    }

    document.getElementById('startGameBtn').addEventListener('click', () => {
      isDemo = false;
      resetGame();
      showSection(gameSection);
    });

    document.getElementById('skipToShopBtn').addEventListener('click', () => {
      // Your team can redirect straight to cart here.
      window.location.href = 'https://yourshop.com/cart?utm_source=catch-skip';
    });

    document.getElementById('doneGameBtn').addEventListener('click', () => {
      showSection(questionsSection);
    });

    document.getElementById('submitQuestionsBtn').addEventListener('click', () => {
      collectAnswers();
      computeReward();
      showSection(resultSection);
    });

    document.getElementById('playDemoBtn').addEventListener('click', () => {
      isDemo = true;
      resetGame();
      showSection(gameSection);
    });

    document.getElementById('shareBtn').addEventListener('click', () => {
      // Placeholder: your team will replace with real share / unique-link logic.
      alert('This is where your unique share link or email / SMS flow will be triggered.');
    });

    // --- GAME LOGIC ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    let dropsLeft = 5;
    let caught = 0;
    let currentBall = null;
    let basket = { x: 120, y: canvas.height - 40, width: 110, height: 12 };
    const ballRadius = 9;
    const gravity = 0.26;      // slightly stronger than before for less floatiness
    const pegRadius = 6;
    const pegs = [];
    let isDemo = false;

    const dropsLeftText = document.getElementById('dropsLeftText');
    const caughtText = document.getElementById('caughtText');

    // Create peg grid: 4 rows, staggered a bit, leave clear space at bottom
    function initPegs() {
      pegs.length = 0;
      const rows = 4;
      const cols = 8;
      const topOffset = 70;
      const rowGap = 55;
      const colGap = canvas.width / (cols + 1);

      for (let r = 0; r < rows; r++) {
        const y = topOffset + r * rowGap;
        for (let c = 0; c < cols; c++) {
          const x = colGap * (c + 1) + (r % 2 === 0 ? 0 : colGap / 2);
          if (x < 20 || x > canvas.width - 20) continue;
          pegs.push({ x, y });
        }
      }
    }

    initPegs();

    function resetGame() {
      dropsLeft = 5;
      caught = 0;
      currentBall = null;
      basket.width = 90; // narrower: about 2/3 of earlier size
      dropsLeftText.textContent = dropsLeft;
      caughtText.textContent = caught;
    }

    function spawnBall() {
      if (dropsLeft <= 0) return;
      dropsLeft--;
      dropsLeftText.textContent = dropsLeft;
      currentBall = {
        x: canvas.width / 2,
        y: 30,
        vx: (Math.random() - 0.5) * 2,
        vy: 0
      };
    }

    function updateBall() {
      if (!currentBall) return;

      currentBall.vy += gravity;
      currentBall.x += currentBall.vx;
      currentBall.y += currentBall.vy;

      // Wall bounce
      if (currentBall.x - ballRadius < 0) {
        currentBall.x = ballRadius;
        currentBall.vx *= -0.65;
      }
      if (currentBall.x + ballRadius > canvas.width) {
        currentBall.x = canvas.width - ballRadius;
        currentBall.vx *= -0.65;
      }

      // Peg collisions
      for (const peg of pegs) {
        const dx = currentBall.x - peg.x;
        const dy = currentBall.y - peg.y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if (dist < pegRadius + ballRadius) {
          // simple reflection
          const nx = dx / (dist || 1);
          const ny = dy / (dist || 1);
          const dot = currentBall.vx * nx + currentBall.vy * ny;
          currentBall.vx -= 2 * dot * nx;
          currentBall.vy -= 2 * dot * ny;
          // add a little randomness and damping
          currentBall.vx *= 0.85 + Math.random()*0.1;
          currentBall.vy *= 0.85 + Math.random()*0.1;
        }
      }

      // Basket catch detection
      if (
        currentBall.y + ballRadius >= basket.y &&
        currentBall.y + ballRadius <= basket.y + basket.height + 6 &&
        currentBall.x >= basket.x &&
        currentBall.x <= basket.x + basket.width
      ) {
        caught++;
        caughtText.textContent = caught;
        currentBall = null;
        // spawn next automatically after a brief pause
        setTimeout(() => {
          if (dropsLeft > 0) spawnBall();
        }, 250);
      }

      // Missed ‚Äì falls below canvas
      if (currentBall && currentBall.y - ballRadius > canvas.height) {
        currentBall = null;
        setTimeout(() => {
          if (dropsLeft > 0) spawnBall();
        }, 250);
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Background is handled by CSS; here we just draw content.
      // Line / "drop zone" at top
      ctx.strokeStyle = '#c7d2fe';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(20, 70);
      ctx.lineTo(canvas.width - 20, 70);
      ctx.stroke();

      // Pegs
      ctx.fillStyle = '#7c3aed';
      for (const peg of pegs) {
        ctx.beginPath();
        ctx.arc(peg.x, peg.y, pegRadius, 0, Math.PI * 2);
        ctx.fill();
      }

      // Basket
      const grad = ctx.createLinearGradient(basket.x, basket.y, basket.x, basket.y + basket.height);
      grad.addColorStop(0, '#2563eb');
      grad.addColorStop(1, '#1d4ed8');
      ctx.fillStyle = grad;
      ctx.beginPath();
      const r = 8;
      ctx.moveTo(basket.x + r, basket.y);
      ctx.lineTo(basket.x + basket.width - r, basket.y);
      ctx.quadraticCurveTo(basket.x + basket.width, basket.y, basket.x + basket.width, basket.y + r);
      ctx.lineTo(basket.x + basket.width, basket.y + basket.height);
      ctx.lineTo(basket.x, basket.y + basket.height);
      ctx.lineTo(basket.x, basket.y + r);
      ctx.quadraticCurveTo(basket.x, basket.y, basket.x + r, basket.y);
      ctx.closePath();
      ctx.fill();

      // Ball
      if (currentBall) {
        ctx.fillStyle = '#fb923c';
        ctx.beginPath();
        ctx.arc(currentBall.x, currentBall.y, ballRadius, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = 'rgba(255,255,255,0.7)';
        ctx.beginPath();
        ctx.arc(currentBall.x - 3, currentBall.y - 3, 3, 0, Math.PI * 2);
        ctx.fill();
      }

      requestAnimationFrame(draw);
    }

    function gameLoop() {
      updateBall();
      requestAnimationFrame(gameLoop);
    }

    // Basket controls
    let isDragging = false;
    let dragOffsetX = 0;

    canvas.addEventListener('mousedown', (e) => {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      if (x >= basket.x && x <= basket.x + basket.width &&
          e.clientY - rect.top >= basket.y - 10) {
        isDragging = true;
        dragOffsetX = x - basket.x;
      }
    });
    window.addEventListener('mouseup', () => { isDragging = false; });

    canvas.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      basket.x = Math.max(10, Math.min(canvas.width - basket.width - 10, x - dragOffsetX));
    });

    // Touch
    canvas.addEventListener('touchstart', (e) => {
      const rect = canvas.getBoundingClientRect();
      const touch = e.touches[0];
      const x = touch.clientX - rect.left;
      const y = touch.clientY - rect.top;
      if (x >= basket.x && x <= basket.x + basket.width &&
          y >= basket.y - 20) {
        isDragging = true;
        dragOffsetX = x - basket.x;
      }
    }, { passive: true });

    canvas.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      const rect = canvas.getBoundingClientRect();
      const touch = e.touches[0];
      const x = touch.clientX - rect.left;
      basket.x = Math.max(10, Math.min(canvas.width - basket.width - 10, x - dragOffsetX));
    }, { passive: true });

    window.addEventListener('touchend', () => { isDragging = false; });

    // Keyboard
    window.addEventListener('keydown', (e) => {
      const step = 16;
      if (e.key === 'ArrowLeft') {
        basket.x = Math.max(10, basket.x - step);
      } else if (e.key === 'ArrowRight') {
        basket.x = Math.min(canvas.width - basket.width - 10, basket.x + step);
      }
    });

    // Start loops and first ball
    resetGame();
    spawnBall();
    draw();
    gameLoop();

    // --- QUESTIONS / REWARD ---
    const answers = {};

    function collectAnswers() {
      function getVal(name) {
        const el = document.querySelector(`input[name="${name}"]:checked`);
        return el ? el.value : null;
      }
      answers.pets = getVal('pets');
      answers.machine = getVal('machine');
      answers.frustration = getVal('frustration');
      answers.petType = getVal('petType');
      answers.cleanScale = getVal('cleanScale');

      // Hook for your team: send these to backend
      console.log('Game caught:', caught, 'Answers:', answers);
    }

    function computeReward() {
      const resultCaught = document.getElementById('resultCaughtCount');
      const rewardTitle = document.getElementById('rewardTitle');
      const rewardSubtitle = document.getElementById('rewardSubtitle');

      resultCaught.textContent = `${caught} / 5`;

      let reward;
      if (caught >= 4) {
        reward = { title: "Free shipping + 10% off", code: "FSHIP10" };
      } else if (caught >= 2) {
        reward = { title: "Free shipping + 5% off", code: "FSHIP5" };
      } else {
        reward = { title: "Free shipping on your next order", code: "FSHIP" };
      }

      rewardTitle.textContent = reward.title;
      rewardSubtitle.textContent = `Nice work! Your reward code is ${reward.code}. It will be baked into your unique link so you do not have to copy/paste anything.`;

      // Reward link placeholder ‚Äì your backend can inject a real unique URL w/ UTM.
      const rewardLinkEl = document.getElementById('rewardLink');
      rewardLinkEl.textContent = `https://yourshop.com/cart?reward=${reward.code}&utm_source=catch-game`;
    }
  </script>
</body>
</html>
