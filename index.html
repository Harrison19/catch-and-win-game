<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Catch & Win Game</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle at top, #f9fbff 0%, #dbe9ff 40%, #c7ddff 100%);
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            color: #14213d;
        }

        .card {
            width: 100%;
            max-width: 420px;
            background: #ffffff;
            border-radius: 24px;
            box-shadow: 0 18px 40px rgba(15, 35, 90, 0.25);
            padding: 20px 20px 24px;
        }

        .logo-wrapper {
            display: flex;
            justify-content: center;
            margin-bottom: 8px;
        }

        #brandLogo {
            max-height: 40px;
            width: auto:
            object-fit: contain;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.08));
        }


        h1 {
            font-size: 22px;
            margin: 4px 0 6px;
            text-align: left;
        }

        .subtitle {
            font-size: 14px;
            color: #526281;
            margin-bottom: 16px;
        }

        .game-frame {
            border-radius: 18px;
            padding: 12px;
            background: linear-gradient(180deg, #f3f6ff 0%, #edf5ff 60%, #e6f3ff 100%);
            box-shadow: inset 0 0 0 1px rgba(103, 135, 255, 0.18);
        }

        canvas {
            width: 100%;
            height: auto;
            background: linear-gradient(180deg, #f6f8ff 0%, #edf4ff 40%, #e6f3ff 100%);
            border-radius: 16px;
            display: block;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            margin-top: 10px;
            color: #526281;
        }

        .controls {
            font-size: 12px;
            color: #7a89a8;
            margin-top: 6px;
        }

        .controls span {
            font-weight: 600;
        }

        .btn-row {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            margin-top: 12px;
        }

        button {
            border-radius: 999px;
            border: none;
            padding: 10px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.06s ease, box-shadow 0.06s ease, background 0.12s ease;
        }

        .btn-primary {
            flex: 1;
            background: linear-gradient(135deg, #2563eb, #294bf7);
            color: #ffffff;
            box-shadow: 0 10px 18px rgba(37, 99, 235, 0.4);
        }

        .btn-primary:active {
            transform: translateY(1px);
            box-shadow: 0 4px 8px rgba(37, 99, 235, 0.4);
        }

        .btn-ghost {
            background: #eef3ff;
            color: #26406f;
            min-width: 90px;
        }

        .btn-ghost:active {
            transform: translateY(1px);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .question-group {
            margin-bottom: 14px;
        }

        label.question-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .options-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .chip {
            border-radius: 999px;
            padding: 6px 12px;
            border: 1px solid #d3ddff;
            font-size: 13px;
            cursor: pointer;
            background: #f6f8ff;
        }

        .chip.selected {
            background: #2563eb;
            color: #ffffff;
            border-color: #2563eb;
        }

        .scale-row {
            display: flex;
            gap: 8px;
            margin-top: 4px;
        }

        .scale-btn {
            flex: 1;
            padding: 6px 0;
            text-align: center;
            font-size: 13px;
            cursor: pointer;
            border-radius: 999px;
            border: 1px solid #d3ddff;
            background: #f6f8ff;
        }

        .scale-btn.selected {
            background: #2563eb;
            color: #ffffff;
            border-color: #2563eb;
        }

        .helper-text {
            font-size: 12px;
            color: #7a89a8;
            margin-top: -2px;
            margin-bottom: 10px;
        }

        .reward {
            font-size: 18px;
            font-weight: 700;
            margin: 8px 0 6px;
        }

        .reward-detail {
            font-size: 14px;
            color: #526281;
            margin-bottom: 12px;
        }

        .tagline {
            font-size: 13px;
            color: #7a89a8;
            margin-bottom: 6px;
        }

        .share-code {
            padding: 8px 10px;
            border-radius: 10px;
            background: #f6f8ff;
            font-size: 13px;
            color: #1f2937;
            word-break: break-all;
        }

        .small-muted {
            font-size: 11px;
            color: #9aa4c7;
            margin-top: 6px;
        }
    </style>
</head>
<body>
<div class="card">
    <div class="logo-wrapper">
        <!-- Replace logo.png with your logo path OR remove this img if not needed -->
        <img id="brandLogo" src="uproot-clean-logo.png" alt="Uproot Clean logo" />
    </div>

    <!-- GAME PAGE -->
    <div id="page-game" class="page active">
        <h1>Catch the drops</h1>
        <p class="subtitle">Bounce through the pegs and catch as many as you can.</p>

        <div class="game-frame">
            <canvas id="gameCanvas" width="320" height="480"></canvas>
        </div>

        <div class="game-info">
            <span id="dropsLeftLabel">Drops left: 5</span>
            <span id="caughtLabel">Caught: 0</span>
        </div>
        <p class="controls">
            Use <span>â—€â–¶</span> or drag to move the basket. You get 5 drops.
        </p>

        <div class="btn-row">
            <button id="dropButton" class="btn-primary">Drop ball</button>
            <button id="continueButton" class="btn-ghost" disabled>I am done, continue</button>
        </div>
    </div>

    <!-- QUESTIONS PAGE -->
    <div id="page-questions" class="page">
        <h1>Quick questions</h1>
        <p class="subtitle">
            Answer a few questions so we can tailor tips and offers to your laundry routine.
        </p>

        <form id="questionForm">
            <div class="question-group">
                <label class="question-label">1. Do you currently have pets?</label>
                <div class="options-row" data-name="havePets">
                    <div class="chip">Yes</div>
                    <div class="chip">No</div>
                </div>
            </div>

            <div class="question-group">
                <label class="question-label">2. What type of washing machine do you use most often?</label>
                <div class="options-row" data-name="machineType">
                    <div class="chip">Top loader</div>
                    <div class="chip">Front loader</div>
                </div>
            </div>

            <div class="question-group">
                <label class="question-label">3. Whatâ€™s your biggest laundry frustration?</label>
                <div class="options-row" data-name="frustration">
                    <div class="chip">Smell</div>
                    <div class="chip">Stains</div>
                    <div class="chip">Time</div>
                    <div class="chip">Pet Hair</div>
                </div>
            </div>

            <div class="question-group">
                <label class="question-label">4. Do you have a dog or cat?</label>
                <div class="options-row" data-name="petType">
                    <div class="chip">Dog</div>
                    <div class="chip">Cat</div>
                    <div class="chip">Both</div>
                    <div class="chip">Neither</div>
                </div>
            </div>

            <div class="question-group">
                <label class="question-label">5. How important is a clean, fresh home to you?</label>
                <p class="helper-text">1 = not important, 5 = extremely important.</p>
                <div class="scale-row" data-name="cleanImportance">
                    <div class="scale-btn">1</div>
                    <div class="scale-btn">2</div>
                    <div class="scale-btn">3</div>
                    <div class="scale-btn">4</div>
                    <div class="scale-btn">5</div>
                </div>
            </div>

            <div class="btn-row">
                <button type="button" id="backToGame" class="btn-ghost">Back</button>
                <button type="submit" class="btn-primary">See my reward</button>
            </div>
        </form>
    </div>

    <!-- RESULT PAGE -->
    <div id="page-result" class="page">
        <h1>Your reward is unlocked ðŸŽ‰</h1>
        <p class="subtitle">
            Thanks for playing and answering a few questions. Here is your offer:
        </p>

        <p class="reward" id="rewardMain"></p>
        <p class="reward-detail" id="rewardDetail"></p>

        <p class="tagline">
            Share this link with a friend so they can play once too:
        </p>
        <div class="share-code" id="shareLink">
            <!-- Your backend can inject a unique share URL here -->
            https://example.com/catch-and-win?share=UNIQUE_ID
        </div>
        <p class="small-muted">
            This offer is valid for 24 hours. When we connect this to Shopify, the button
            below will send you straight back with a tracked link (UTM) so you get credit
            for the order.
        </p>

        <div class="btn-row">
            <button id="playAgainLocal" class="btn-ghost">Play again (this demo)</button>
            <button id="goToSite" class="btn-primary">Go to site</button>
        </div>
    </div>
</div>

<script>
    // ---------- GAME LOGIC ----------
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const dropsTotal = 5;
    let dropsLeft = dropsTotal;
    let caught = 0;

    const dropsLeftLabel = document.getElementById("dropsLeftLabel");
    const caughtLabel = document.getElementById("caughtLabel");
    const dropButton = document.getElementById("dropButton");
    const continueButton = document.getElementById("continueButton");

    const width = canvas.width;
    const height = canvas.height;

    // Peg config: 4 rows for more suspense / difficulty
    const pegRadius = 7;
    const pegRows = 4;
    const pegs = [];

    // Build peg grid
    (function createPegs() {
        const verticalStart = 110; // little space before first row
        const verticalGap = 65;
        for (let row = 0; row < pegRows; row++) {
            const y = verticalStart + row * verticalGap;
            const cols = 6;
            const horizontalMargin = 40;
            const horizontalGap =
                (width - horizontalMargin * 2) / (cols - 1);

            for (let col = 0; col < cols; col++) {
                let x =
                    horizontalMargin + col * horizontalGap +
                    (row % 2 === 0 ? 0 : horizontalGap / 2); // staggered
                pegs.push({ x, y });
            }
        }
    })();

    const basket = {
        width: 110,
        height: 10,
        y: height - 50,
        x: width / 2 - 55,
        speed: 7
    };

    let ball = null;
    let isDropping = false;

    const gravity = 0.25; // a bit lighter than last time
    const bounceDamping = 0.88;

    function startDrop() {
        if (isDropping || dropsLeft <= 0) return;

        dropsLeft--;
        dropsLeftLabel.textContent = "Drops left: " + dropsLeft;

        // Start ball near top center with slight random horizontal offset
        ball = {
            x: width / 2 + (Math.random() * 40 - 20),
            y: 70,
            vx: Math.random() * 1.2 - 0.6,
            vy: 1,
            r: 9
        };
        isDropping = true;

        if (dropsLeft === 0) {
            // As soon as last drop starts, we know they can't get more
            // We'll enable the continue button when the ball finishes moving
        }
    }

    function updateBall() {
        if (!ball) return;

        ball.vy += gravity;
        ball.x += ball.vx;
        ball.y += ball.vy;

        // Wall collisions
        if (ball.x - ball.r < 10) {
            ball.x = 10 + ball.r;
            ball.vx *= -bounceDamping;
        }
        if (ball.x + ball.r > width - 10) {
            ball.x = width - 10 - ball.r;
            ball.vx *= -bounceDamping;
        }

        // Peg collisions
        for (const peg of pegs) {
            const dx = ball.x - peg.x;
            const dy = ball.y - peg.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            const minDist = ball.r + pegRadius;
            if (dist < minDist) {
                // Simple reflection
                const nx = dx / dist;
                const ny = dy / dist;
                const dot = ball.vx * nx + ball.vy * ny;
                ball.vx = ball.vx - 2 * dot * nx;
                ball.vy = ball.vy - 2 * dot * ny;

                ball.vx *= bounceDamping;
                ball.vy *= bounceDamping;

                // Nudge out of peg
                const overlap = minDist - dist;
                ball.x += nx * overlap;
                ball.y += ny * overlap;
            }
        }

        // Basket / floor check
        if (ball.y - ball.r > height) {
            // Drop finished
            const withinBasket =
                ball.x >= basket.x &&
                ball.x <= basket.x + basket.width;

            if (withinBasket) {
                caught++;
                caughtLabel.textContent = "Caught: " + caught;
            }

            isDropping = false;
            ball = null;

            if (dropsLeft === 0) {
                continueButton.disabled = false;
            }
        }
    }

    function drawBackground() {
        // soft background already via CSS; here we draw "board" interior
        ctx.clearRect(0, 0, width, height);

        // Peg board background
        const grad = ctx.createLinearGradient(0, 0, 0, height);
        grad.addColorStop(0, "#f7f9ff");
        grad.addColorStop(0.6, "#edf3ff");
        grad.addColorStop(1, "#e5f0ff");
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, width, height);

        // top line
        ctx.strokeStyle = "rgba(137, 158, 255, 0.45)";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(18, 95);
        ctx.lineTo(width - 18, 95);
        ctx.stroke();
    }

    function drawPegs() {
        ctx.fillStyle = "#7c3aed";
        for (const peg of pegs) {
            ctx.beginPath();
            ctx.arc(peg.x, peg.y, pegRadius, 0, Math.PI * 2);
            ctx.fill();
        }
    }

    function drawBasket() {
        const x = basket.x;
        const y = basket.y;
        const w = basket.width;
        const h = basket.height;

        const grad = ctx.createLinearGradient(x, y, x, y + h + 14);
        grad.addColorStop(0, "#2563eb");
        grad.addColorStop(1, "#1d4ed8");

        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.roundRect(x, y, w, h + 14, 16);
        ctx.fill();

        ctx.fillStyle = "#eff6ff";
        ctx.fillRect(x + 14, y + 5, w - 28, 5);
    }

    function drawBall() {
        if (!ball) return;
        const grad = ctx.createRadialGradient(
            ball.x - 3,
            ball.y - 3,
            2,
            ball.x,
            ball.y,
            ball.r + 2
        );
        grad.addColorStop(0, "#ffbb4a");
        grad.addColorStop(1, "#f97316");
        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
        ctx.fill();

        // small highlight
        ctx.fillStyle = "rgba(255,255,255,0.85)";
        ctx.beginPath();
        ctx.arc(ball.x - 3, ball.y - 4, 3, 0, Math.PI * 2);
        ctx.fill();
    }

    function loop() {
        drawBackground();
        drawPegs();
        drawBasket();
        if (isDropping) {
            updateBall();
        }
        drawBall();
        requestAnimationFrame(loop);
    }

    loop();

    // Basket movement: arrow keys + dragging
    document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowLeft") {
            basket.x -= basket.speed * 3;
        } else if (e.key === "ArrowRight") {
            basket.x += basket.speed * 3;
        }
        clampBasket();
    });

    function clampBasket() {
        if (basket.x < 16) basket.x = 16;
        if (basket.x + basket.width > width - 16) {
            basket.x = width - 16 - basket.width;
        }
    }

    let dragging = false;

    canvas.addEventListener("pointerdown", (e) => {
        dragging = true;
        moveBasketFromEvent(e);
    });
    window.addEventListener("pointermove", (e) => {
        if (!dragging) return;
        moveBasketFromEvent(e);
    });
    window.addEventListener("pointerup", () => (dragging = false));

    function moveBasketFromEvent(e) {
        const rect = canvas.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * width;
        basket.x = x - basket.width / 2;
        clampBasket();
    }

    dropButton.addEventListener("click", startDrop);

    // ---------- PAGE / QUESTION LOGIC ----------

    const pageGame = document.getElementById("page-game");
    const pageQuestions = document.getElementById("page-questions");
    const pageResult = document.getElementById("page-result");

    function showPage(page) {
        [pageGame, pageQuestions, pageResult].forEach((p) =>
            p.classList.remove("active")
        );
        page.classList.add("active");
    }

    continueButton.addEventListener("click", () => {
        showPage(pageQuestions);
    });

    document.getElementById("backToGame").addEventListener("click", () => {
        showPage(pageGame);
    });

    // Chip + scale selection
    function setupSelectableGroups() {
        document
            .querySelectorAll(".options-row")
            .forEach((row) => {
                row.addEventListener("click", (e) => {
                    if (!e.target.classList.contains("chip")) return;
                    row.querySelectorAll(".chip").forEach((c) =>
                        c.classList.remove("selected")
                    );
                    e.target.classList.add("selected");
                });
            });

        document
            .querySelectorAll(".scale-row")
            .forEach((row) => {
                row.addEventListener("click", (e) => {
                    if (!e.target.classList.contains("scale-btn")) return;
                    row.querySelectorAll(".scale-btn").forEach((c) =>
                        c.classList.remove("selected")
                    );
                    e.target.classList.add("selected");
                });
            });
    }
    setupSelectableGroups();

    const questionForm = document.getElementById("questionForm");
    const rewardMain = document.getElementById("rewardMain");
    const rewardDetail = document.getElementById("rewardDetail");

    questionForm.addEventListener("submit", (e) => {
        e.preventDefault();

        const answers = {};

        document
            .querySelectorAll(".options-row")
            .forEach((row) => {
                const name = row.getAttribute("data-name");
                const selected = row.querySelector(".chip.selected");
                answers[name] = selected ? selected.textContent : "";
            });

        document
            .querySelectorAll(".scale-row")
            .forEach((row) => {
                const name = row.getAttribute("data-name");
                const selected = row.querySelector(".scale-btn.selected");
                answers[name] = selected ? selected.textContent : "";
            });

        // Determine reward based on caught count
        let rewardText = "";
        let detailText = "";

        if (caught >= 4) {
            rewardText = "Free shipping + 10% off";
            detailText =
                "Nice reflexes. You caught " +
                caught +
                " drops, so you unlocked free shipping plus 10% off your next order.";
        } else if (caught >= 2) {
            rewardText = "Free shipping + 5% off";
            detailText =
                "Great catch! With " +
                caught +
                " drops, you get free shipping and 5% off your next order.";
        } else if (caught >= 1) {
            rewardText = "Free shipping";
            detailText =
                "You caught " +
                caught +
                " drop. You unlocked free shipping on your next order.";
        } else {
            rewardText = "Almost! Free shipping on your next try";
            detailText =
                "You did not catch a drop this round, but you can still unlock free shipping when you play again.";
        }

        rewardMain.textContent = rewardText;
        rewardDetail.textContent = detailText;

        // In your real integration, send `answers` + `caught` to your backend here.

        showPage(pageResult);
    });

    // Demo-only buttons
    document
        .getElementById("playAgainLocal")
        .addEventListener("click", () => {
            // reset game
            dropsLeft = dropsTotal;
            caught = 0;
            dropsLeftLabel.textContent = "Drops left: " + dropsLeft;
            caughtLabel.textContent = "Caught: " + caught;
            continueButton.disabled = true;
            showPage(pageGame);
        });

    document.getElementById("goToSite").addEventListener("click", () => {
        // Placeholder â€“ your team can swap this for the Shopify + UTM link
        window.location.href =
            "https://example.com/?utm_source=catch-and-win-demo";
    });
</script>
</body>
</html>
