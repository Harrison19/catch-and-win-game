<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Catch the Drops – Uproot Clean</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        /* Page + card layout */
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at top, #e9f5ff 0%, #c7ddff 45%, #b4c9ff 100%);
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            color: #182244;
        }

        .card {
            width: 420px;
            max-width: 100%;
            background: #fdfdff;
            border-radius: 28px;
            box-shadow: 0 20px 60px rgba(6, 33, 87, 0.25);
            padding: 24px 24px 28px;
            box-sizing: border-box;
        }

        .logo-row {
            display: flex;
            justify-content: center;
            margin-bottom: 8px;
        }

        .logo-row img {
            max-width: 240px;
            height: auto;
        }

        h1 {
            font-size: 22px;
            margin: 8px 0 4px;
        }

        p {
            margin: 4px 0;
            font-size: 14px;
            line-height: 1.4;
        }

        .highlight-box {
            margin-top: 16px;
            border-radius: 18px;
            padding: 16px 18px;
            background: linear-gradient(135deg, #e8f0ff, #f5fbff);
        }

        .pill-row {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .pill {
            padding: 6px 12px;
            border-radius: 999px;
            background: #ffffff;
            border: 1px solid rgba(92, 123, 255, 0.25);
            font-size: 12px;
            color: #3752e8;
            font-weight: 600;
        }

        .muted {
            font-size: 12px;
            color: #6e7aa8;
        }

        .button-row {
            margin-top: 22px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            border-radius: 999px;
            padding: 11px 16px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2468ff, #3056ff);
            color: #ffffff;
            box-shadow: 0 6px 18px rgba(42, 90, 255, 0.45);
        }

        .btn-ghost {
            background: #ffffff;
            color: #1a2b5c;
            border: 1px solid rgba(167, 176, 219, 0.7);
        }

        .hidden {
            display: none;
        }

        /* Game section */
        .game-shell {
            margin-top: 12px;
            border-radius: 22px;
            padding: 18px 16px 16px;
            background: linear-gradient(180deg, #f3f7ff 0%, #edf5ff 40%, #e7f3ff 100%);
            box-shadow: inset 0 0 0 1px rgba(208, 217, 252, 0.6);
        }

        canvas {
            display: block;
            margin: 0 auto 10px;
            background: linear-gradient(180deg, #f6f9ff 0%, #eef4ff 60%, #eaf5ff 100%);
            border-radius: 16px;
            box-shadow: inset 0 0 0 1px rgba(201, 211, 252, 0.6);
        }

        .game-status {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            font-size: 12px;
            color: #5c6794;
            margin-top: 4px;
        }

        .game-tip {
            margin-top: 3px;
            font-size: 11px;
            color: #9aa2c7;
        }

        .stat-number {
            font-weight: 600;
            color: #3651ff;
        }

        /* Questions screen */
        .question-block {
            margin-top: 14px;
        }

        .question-label {
            font-size: 14px;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .option-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
        }

        .chip {
            border-radius: 999px;
            padding: 6px 11px;
            border: 1px solid #c7cff5;
            font-size: 12px;
            cursor: pointer;
            background: #ffffff;
            color: #48507f;
        }

        .chip.selected {
            background: #2f57ff;
            color: #ffffff;
            border-color: #2f57ff;
        }

        .range-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 4px;
        }

        input[type="range"] {
            flex: 1;
        }

        .range-value {
            min-width: 20px;
            text-align: center;
            font-size: 13px;
            font-weight: 600;
            color: #2f57ff;
        }

        /* Result screen */
        .reward-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 999px;
            background: #ecf2ff;
            color: #2840c6;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }

        .reward-large {
            font-size: 18px;
            margin-top: 12px;
        }

        .secondary-actions {
            margin-top: 14px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-small {
            flex: 1;
            font-size: 13px;
            padding: 9px 12px;
        }

        a {
            color: inherit;
            text-decoration: none;
        }
    </style>
</head>
<body>
<div class="card">
    <div class="logo-row">
        <!-- Make sure Logo_UprootClean.webp exists next to this file and matches case exactly -->
        <img src="Logo_UprootClean.webp" alt="Uproot Clean" />
    </div>

    <!-- Intro screen -->
    <section id="introScreen">
        <h1>Catch the drops</h1>
        <p>You get 5 chances to catch as many drops as you can. The more you catch, the better your reward.</p>

        <div class="highlight-box">
            <p class="muted">Here is what you can win:</p>
            <div class="pill-row">
                <div class="pill">Free shipping</div>
                <div class="pill">+ 5% off</div>
                <div class="pill">+ 10% off</div>
            </div>
            <p class="muted" style="margin-top: 10px;">
                Your reward is based on how many drops you catch. No pressure, just a little fun while your cart waits.
            </p>
        </div>

        <p class="muted" style="margin-top: 14px;">
            Takes about 30–45 seconds. No app to download.
        </p>

        <div class="button-row">
            <button id="startGameBtn" class="btn btn-primary">
                Play &amp; reveal my reward
            </button>
        </div>
    </section>

    <!-- Game screen -->
    <section id="gameScreen" class="hidden">
        <h1>Catch the drops</h1>
        <p>Bounce through the pegs and catch as many as you can.</p>

        <div class="game-shell">
            <canvas id="gameCanvas" width="320" height="420"></canvas>
            <div class="game-status">
                <span>Drops left: <span id="dropsLeft" class="stat-number">5</span></span>
                <span>Caught: <span id="caughtCount" class="stat-number">0</span></span>
            </div>
            <div class="game-tip">
                Tip: drag or use ◀▶ to move the basket.
            </div>
        </div>
    </section>

    <!-- Questions screen -->
    <section id="questionsScreen" class="hidden">
        <h1>Quick questions</h1>
        <p class="muted">A few quick questions so we can tailor future tips and offers.</p>

        <div class="question-block">
            <div class="question-label">1. Do you have pets?</div>
            <div class="option-row" data-question="pets" id="qPets">
                <button class="chip" data-value="yes">Yes</button>
                <button class="chip" data-value="no">No</button>
            </div>
        </div>

        <div class="question-block">
            <div class="question-label">2. What type of machine do you use?</div>
            <div class="option-row" data-question="machine" id="qMachine">
                <button class="chip" data-value="top">Top loader</button>
                <button class="chip" data-value="front">Front loader</button>
            </div>
        </div>

        <div class="question-block">
            <div class="question-label">3. What is your biggest laundry frustration?</div>
            <div class="option-row" data-question="frustration" id="qFrustration">
                <button class="chip" data-value="smell">Smell</button>
                <button class="chip" data-value="stains">Stains</button>
                <button class="chip" data-value="time">Time</button>
                <button class="chip" data-value="pet-hair">Pet hair</button>
            </div>
        </div>

        <div class="question-block">
            <div class="question-label">4. Do you have a dog or cat?</div>
            <div class="option-row" data-question="petType" id="qPetType">
                <button class="chip" data-value="dog">Dog</button>
                <button class="chip" data-value="cat">Cat</button>
                <button class="chip" data-value="both">Both</button>
                <button class="chip" data-value="neither">Neither</button>
            </div>
        </div>

        <div class="question-block">
            <div class="question-label">5. How important is a clean, fresh home?</div>
            <div class="range-row">
                <span class="muted">Not very</span>
                <input id="importanceRange" type="range" min="1" max="5" value="4" />
                <span class="muted">Very</span>
                <span id="importanceValue" class="range-value">4</span>
            </div>
        </div>

        <div class="button-row" style="margin-top: 22px;">
            <button id="questionsNextBtn" class="btn btn-primary">
                See my reward
            </button>
        </div>
    </section>

    <!-- Result screen -->
    <section id="resultScreen" class="hidden">
        <h1>Your reward is ready</h1>
        <p class="muted" id="resultSummary"></p>

        <div class="reward-tag">
            Reward unlocked
            <span id="rewardLabel"></span>
        </div>

        <p id="rewardDetail" class="reward-large"></p>

        <p class="muted">
            Click below to head back to your cart with this reward applied. Your offer will stay live for 24 hours.
        </p>

        <div class="button-row">
            <button id="useRewardBtn" class="btn btn-primary">
                Use my reward
            </button>
        </div>

        <div class="secondary-actions">
            <button id="playDemoBtn" class="btn btn-ghost btn-small">
                Play a quick demo
            </button>
            <button id="shareBtn" class="btn btn-ghost btn-small">
                Share this with a friend
            </button>
        </div>
    </section>
</div>

<script>
    // ---------- Screen management ----------
    const introScreen = document.getElementById("introScreen");
    const gameScreen = document.getElementById("gameScreen");
    const questionsScreen = document.getElementById("questionsScreen");
    const resultScreen = document.getElementById("resultScreen");

    function showScreen(name) {
        introScreen.classList.add("hidden");
        gameScreen.classList.add("hidden");
        questionsScreen.classList.add("hidden");
        resultScreen.classList.add("hidden");

        switch (name) {
            case "intro":
                introScreen.classList.remove("hidden");
                break;
            case "game":
                gameScreen.classList.remove("hidden");
                break;
            case "questions":
                questionsScreen.classList.remove("hidden");
                break;
            case "result":
                resultScreen.classList.remove("hidden");
                break;
        }
    }

    // ---------- Game setup ----------
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const dropsLeftSpan = document.getElementById("dropsLeft");
    const caughtSpan = document.getElementById("caughtCount");

    const width = canvas.width;
    const height = canvas.height;

    const ball = {
        x: width / 2,
        y: 60,
        radius: 7,
        vx: 0,
        vy: 0
    };

    const basket = {
        width: 80, // narrower than before
        height: 12,
        x: width / 2 - 40,
        y: height - 50,
        speed: 5
    };

    const pegRadius = 6;
    const pegs = [];

    let gravity = 0.25;
    let dropsTotal = 5;
    let dropsLeft = dropsTotal;
    let caught = 0;
    let isDropping = false;
    let currentScreen = "intro";

    function createPegs() {
        pegs.length = 0;
        const rows = 4; // a bit more challenging
        const cols = 7;
        const topOffset = 110;
        const rowSpacing = 55;
        const colSpacing = width / (cols + 1);

        for (let row = 0; row < rows; row++) {
            for (let col = 0; col < cols; col++) {
                const x = colSpacing * (col + 1);
                const y = topOffset + rowSpacing * row;
                pegs.push({ x, y });
            }
        }
    }

    function resetGameState() {
        dropsLeft = dropsTotal;
        caught = 0;
        dropsLeftSpan.textContent = dropsLeft;
        caughtSpan.textContent = caught;
        createPegs();
        startNewDrop();
    }

    function randomStartX() {
        const margin = 40;
        return Math.random() * (width - margin * 2) + margin;
    }

    function startNewDrop() {
        if (dropsLeft <= 0) {
            // Small pause, then move to questions
            setTimeout(() => {
                currentScreen = "questions";
                showScreen("questions");
            }, 650);
            return;
        }

        ball.x = randomStartX();
        ball.y = 70;
        ball.vx = 0;
        ball.vy = 1.5;
        isDropping = true;
    }

    function updateBall() {
        if (!isDropping || currentScreen !== "game") return;

        ball.vy += gravity;
        ball.y += ball.vy;
        ball.x += ball.vx;

        // Wall collisions
        if (ball.x - ball.radius < 10) {
            ball.x = 10 + ball.radius;
            ball.vx = Math.abs(ball.vx) * 0.8;
        } else if (ball.x + ball.radius > width - 10) {
            ball.x = width - 10 - ball.radius;
            ball.vx = -Math.abs(ball.vx) * 0.8;
        }

        // Peg collisions
        for (const peg of pegs) {
            const dx = ball.x - peg.x;
            const dy = ball.y - peg.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            if (dist < ball.radius + pegRadius) {
                // Simple bounce: push upward and nudge sideways
                const side = dx < 0 ? -1 : 1;
                ball.vy = -Math.abs(ball.vy) * 0.6;
                ball.vx += side * 0.9;
                // Slightly separate them to avoid sticking
                const overlap = ball.radius + pegRadius - dist;
                ball.x += (dx / dist) * overlap;
                ball.y += (dy / dist) * overlap;
            }
        }

        // Basket catch or miss
        if (ball.y - ball.radius > height) {
            isDropping = false;
            dropsLeft--;
            dropsLeftSpan.textContent = dropsLeft;

            const withinX =
                ball.x >= basket.x &&
                ball.x <= basket.x + basket.width;

            if (withinX) {
                caught++;
                caughtSpan.textContent = caught;
            }

            setTimeout(startNewDrop, 550);
        }
    }

    function drawGame() {
        ctx.clearRect(0, 0, width, height);

        // soft background
        const grad = ctx.createLinearGradient(0, 0, 0, height);
        grad.addColorStop(0, "#f8fbff");
        grad.addColorStop(1, "#e5f1ff");
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, width, height);

        // top line
        ctx.strokeStyle = "#d1dafc";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(28, 95);
        ctx.lineTo(width - 28, 95);
        ctx.stroke();

        // pegs
        ctx.fillStyle = "#7b40ff";
        for (const peg of pegs) {
            ctx.beginPath();
            ctx.arc(peg.x, peg.y, pegRadius, 0, Math.PI * 2);
            ctx.fill();
        }

        // basket
        ctx.fillStyle = "#245cff";
        const basketRadius = 12;
        const bx = basket.x;
        const by = basket.y;
        const bw = basket.width;
        const bh = basket.height;

        const r = basketRadius;
        ctx.beginPath();
        ctx.moveTo(bx + r, by);
        ctx.lineTo(bx + bw - r, by);
        ctx.quadraticCurveTo(bx + bw, by, bx + bw, by + r);
        ctx.lineTo(bx + bw, by + bh - r);
        ctx.quadraticCurveTo(bx + bw, by + bh, bx + bw - r, by + bh);
        ctx.lineTo(bx + r, by + bh);
        ctx.quadraticCurveTo(bx, by + bh, bx, by + bh - r);
        ctx.lineTo(bx, by + r);
        ctx.quadraticCurveTo(bx, by, bx + r, by);
        ctx.fill();

        // ball
        ctx.fillStyle = "#ff8a2b";
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = "rgba(255,255,255,0.7)";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(ball.x - 2, ball.y - 2, ball.radius / 2, 0, Math.PI * 2);
        ctx.stroke();
    }

    function gameLoop() {
        if (currentScreen === "game") {
            updateBall();
            drawGame();
        }
        requestAnimationFrame(gameLoop);
    }

    // ---------- Basket controls ----------
    let isDragging = false;
    let dragOffsetX = 0;

    canvas.addEventListener("mousedown", (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        if (x >= basket.x && x <= basket.x + basket.width) {
            isDragging = true;
            dragOffsetX = x - basket.x;
        }
    });

    window.addEventListener("mouseup", () => {
        isDragging = false;
    });

    window.addEventListener("mousemove", (e) => {
        if (!isDragging || currentScreen !== "game") return;
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        basket.x = x - dragOffsetX;
        clampBasket();
    });

    canvas.addEventListener("touchstart", (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.touches[0].clientX - rect.left;
        if (x >= basket.x && x <= basket.x + basket.width) {
            isDragging = true;
            dragOffsetX = x - basket.x;
        }
    });

    window.addEventListener("touchend", () => {
        isDragging = false;
    });

    window.addEventListener("touchmove", (e) => {
        if (!isDragging || currentScreen !== "game") return;
        const rect = canvas.getBoundingClientRect();
        const x = e.touches[0].clientX - rect.left;
        basket.x = x - dragOffsetX;
        clampBasket();
    }, { passive: false });

    function clampBasket() {
        const minX = 25;
        const maxX = width - basket.width - 25;
        if (basket.x < minX) basket.x = minX;
        if (basket.x > maxX) basket.x = maxX;
    }

    window.addEventListener("keydown", (e) => {
        if (currentScreen !== "game") return;
        if (e.key === "ArrowLeft") {
            basket.x -= basket.speed;
            clampBasket();
        } else if (e.key === "ArrowRight") {
            basket.x += basket.speed;
            clampBasket();
        }
    });

    // ---------- Questions selection ----------
    const answerState = {
        pets: null,
        machine: null,
        frustration: null,
        petType: null,
        importance: 4
    };

    function setupChipGroup(id, key) {
        const container = document.getElementById(id);
        const chips = container.querySelectorAll(".chip");
        chips.forEach((chip) => {
            chip.addEventListener("click", () => {
                chips.forEach((c) => c.classList.remove("selected"));
                chip.classList.add("selected");
                answerState[key] = chip.dataset.value;
            });
        });
    }

    setupChipGroup("qPets", "pets");
    setupChipGroup("qMachine", "machine");
    setupChipGroup("qFrustration", "frustration");
    setupChipGroup("qPetType", "petType");

    const importanceRange = document.getElementById("importanceRange");
    const importanceValue = document.getElementById("importanceValue");
    importanceRange.addEventListener("input", () => {
        answerState.importance = parseInt(importanceRange.value, 10);
        importanceValue.textContent = importanceRange.value;
    });

    // ---------- Reward + navigation ----------
    document.getElementById("startGameBtn").addEventListener("click", () => {
        currentScreen = "game";
        showScreen("game");
        resetGameState();
    });

    document.getElementById("questionsNextBtn").addEventListener("click", () => {
        const summary = `You caught ${caught} out of ${dropsTotal} drops.`;
        let discount = 0;
        if (caught >= 4) discount = 10;
        else if (caught >= 2) discount = 5;

        const rewardLabel = document.getElementById("rewardLabel");
        const rewardDetail = document.getElementById("rewardDetail");
        const resultSummary = document.getElementById("resultSummary");

        let labelText = "Free shipping";
        if (discount > 0) {
            labelText += " + " + discount + "% off";
        }

        rewardLabel.textContent = labelText;
        rewardDetail.textContent = labelText;

        resultSummary.textContent = summary;

        currentScreen = "result";
        showScreen("result");

        // Here you would also send answerState and caught to your backend
        // to store in a customer profile.
        console.log("Game result:", { caught, dropsTotal });
        console.log("Answers:", answerState);
    });

    // Placeholder: use reward – replace URL with your cart + UTM
    document.getElementById("useRewardBtn").addEventListener("click", () => {
        const url = "https://your-site.com/cart?utm_source=uproot_game&utm_medium=abandoned_cart&utm_campaign=catch_and_clean";
        window.location.href = url;
    });

    // Play demo again – just for fun, does not change stored reward server-side
    document.getElementById("playDemoBtn").addEventListener("click", () => {
        currentScreen = "game";
        showScreen("game");
        resetGameState();
    });

    // Share with a friend – placeholder
    document.getElementById("shareBtn").addEventListener("click", async () => {
        const shareUrl = "https://your-site.com/game?ref=SHARE_TOKEN_PLACEHOLDER";

        if (navigator.share) {
            try {
                await navigator.share({
                    title: "Catch the drops with Uproot Clean",
                    text: "I just played this quick game and unlocked a reward. You can try it too:",
                    url: shareUrl
                });
            } catch (err) {
                console.log("Share cancelled", err);
            }
        } else if (navigator.clipboard) {
            await navigator.clipboard.writeText(shareUrl);
            alert("Share link copied. Send it to a friend to let them play.");
        } else {
            alert("Here is your share link:\n" + shareUrl);
        }
    });

    // Start the animation loop
    createPegs();
    gameLoop();
</script>
</body>
</html>
